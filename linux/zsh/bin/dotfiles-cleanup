#!/bin/sh

# Issues occurring with the script: vim & zsh
echo 'Unstowing...'
dotstow unstow git antigen tmux tmuxp vscode dxvk

echo 'Backing up...'
rm -rf $HOME/.backups
mkdir -p $HOME/.backups
mkdir -p $HOME/.binbackups

if [ -d "$HOME/.ssh" ]; then
  cp -rf $HOME/.ssh $HOME/.backups
fi
if [ -d "$HOME/.zsh" ]; then
  cp -rf $HOME/.zsh $HOME/.backups
fi
if [ -f "$HOME/.zshrc" ]; then
  cp -f $HOME/.zshrc $HOME/.backups
fi
if [ -f "$HOME/.zprofile" ]; then
  cp -f $HOME/.zprofile $HOME/.backups
fi
if [ -f "$HOME/.profile" ]; then
  cp -f $HOME/.profile $HOME/.backups
fi
if [ -f "$HOME/.zshrc.pre-oh-my-zsh" ]; then
  cp -f $HOME/.zshrc.pre-oh-my-zsh $HOME/.backups
fi
if [ -d "$HOME/.git" ]; then
  cp -rf $HOME/.git $HOME/.backups
fi
if [ -d "$HOME/bin" ]; then
  cp -rf $HOME/bin/* $HOME/.binbackups/
fi

echo 'Cleaning up tmux...'
rm -f $HOME/.tmux.conf.local

echo 'Cleaning up VSCode...'
rm -rf $HOME/.vscode
rm -rf $HOME/.vscode-server

echo 'Cleaning up scripts...'
if [ -f "$HOME/bin/dotfiles-cleanup-bin" ]; then
  sh $HOME/bin/dotfiles-cleanup-bin
else
  echo "Warning: $HOME/bin/dotfiles-cleanup-bin does not exist. Skipping script cleanup."
fi

echo 'Cleaning up conflicting files for stow...'
# Remove files that might conflict with stow
find $HOME -type f \( \
  -name ".gitconfig" -o \
  -name ".alacritty.yml" -o \
  -name ".antigenrc" -o \
  -name "bash_completion.d" -o \
  -name "default.yml" -o \
  -name ".dxvk" -o \
  -name ".hushlogin" -o \
  -name ".zprofile" -o \
  -name ".profile" -o \
  -name ".tmuxp" -o \
  -name ".vimrc" -o \
  -name ".virc" -o \
  -name "gpg.conf" -o \
  -name "gpg-agent.conf" -o \
  -name ".zsh" -o \
  -name ".zshrc" -o \
  -name ".zshrc.pre-oh-my-zsh" -o \
  -name ".git" \
\) -exec rm -f {} \;

# Python version tag cleanup. Ensure to get values from .dotfiles-python-version
echo 'Cleaning up Python version tag...'
rm -f $HOME/.dotfiles-python-version
if [ -d "$HOME/.dotfiles" ]; then
  cp -f $HOME/.dotfiles/.dotfiles-python-version $HOME/linux/systems/.dotfiles-python-version
else
  # Add a warning if the directory doesn't exist
  echo "Warning: $HOME/.dotfiles directory does not exist!"
fi

# Avoid removing ssh
echo 'y' || cp -rf $HOME/.ssh $HOME/.ssh-backup
