#!/bin/sh

# Generates ASCII art of a thunder based on a emoji.
thunder() {
  cat << "EOF"
        'z$$$$$$"'
      z$$$$$"
    z$$$$P
  .d$$$$$$$$$$$$"'
    '***$$$$$$"'
        .$$"
      .$P"
      /'
EOF
}

if [ "$1" = "install" ]; then
  echo "Opening the webpage.. Automatic installation is not supported yet."
  if command -v xdg-open >/dev/null 2>&1; then
    xdg-open "https://collabnix.com/how-to-run-docker-in-a-rootless-mode/"
  elif command -v gnome-open >/dev/null 2>&1; then
    gnome-open "https://collabnix.com/how-to-run-docker-in-a-rootless-mode/"
  elif command -v open >/dev/null 2>&1; then
    open "https://collabnix.com/how-to-run-docker-in-a-rootless-mode/"
  else
    echo "Please open the following URL in your browser to install Docker:"
    echo "https://collabnix.com/how-to-run-docker-in-a-rootless-mode/"
  fi
elif [ "$1" = "start" ]; then
  systemctl --user start docker.service
  systemctl --user start docker.socket
  thunder
  if command -v zenity >/dev/null 2>&1; then
    zenity --info --title="Docker started" --text="Docker services started."
  else
    echo "Docker started"
    echo "Docker services started."
  fi
elif [ "$1" = "stop" ]; then
  systemctl --user disable --now docker.service
  systemctl --user disable --now docker.socket
  if command -v zenity >/dev/null 2>&1; then
    zenity --info --title="Docker stopped" --text="Docker services stopped."
  else
    echo "Docker stopped"
    echo "Docker services stopped."
  fi
elif [ "$1" = "startup" ]; then
  systemctl --user enable --now docker.service
  systemctl --user enable --now docker.socket
  thunder
  if command -v zenity >/dev/null 2>&1; then
    zenity --info --title="Docker will be started on startup." --text="Please make sure to execute dotfiles-docker stop if you want to disable this."
  else
    echo "Docker will be started on startup."
    echo "Please make sure to execute dotfiles-docker stop if you want to disable this."
  fi
else
  echo "Usage: $0 {install|start|startup|stop}"
  echo "  install: Installs docker and configures it for the current user (Rootless)"
  echo "  start: Starts docker services"
  echo "  startup: Starts docker services on startup. Will also execute 'start'"
  echo "  stop: Stops docker from running"
  exit 1
fi
